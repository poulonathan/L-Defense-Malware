import tkinter as tk
from tkinter import filedialog, messagebox
import pyclamd

# Initialize the ClamAV daemon using TCP socket
def initialize_clamd():
    try:
        cd = pyclamd.ClamdNetworkSocket('127.0.0.1', 3310)
        cd.ping()  # Verify connection
        return cd
    except pyclamd.ConnectionError:
        messagebox.showerror(
            "Connection Error", 
            "Could not connect to ClamAV daemon. Ensure it is running and configured properly."
        )
        return None

cd = initialize_clamd()

# Function to scan a file
def scan_file():
    if cd is None:
        messagebox.showerror("Connection Error", "ClamAV daemon is not connected.")
        return

    file_path = filedialog.askopenfilename()
    if file_path:
        try:
            result = cd.scan_file(file_path)
            if result is None:
                messagebox.showinfo("Scan Result", "No threats found.")
            else:
                messagebox.showwarning("Scan Result", f"Threats found: {result}")
        except Exception as e:
            messagebox.showerror("Error", f"An error occurred while scanning: {e}")

# Set up the GUI system
def create_gui():
    root = tk.Tk()
    root.title("L-Defense")
    root.geometry("400x200")

    label = tk.Label(root, text="L-Defense Malware Detection", font=("Arial", 16))
    label.pack(pady=20)

    scan_button = tk.Button(root, text="Scan File", command=scan_file, font=("Arial", 14))
    scan_button.pack(pady=20)

    root.mainloop()

if __name__ == "__main__":
    create_gui()
